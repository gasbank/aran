% -*- TeX:UTF-8 -*-
%%
%% KAIST 학위논문양식 LaTeX용 (ver 0.4) 예시
%%
%% @version 0.4
%% @author  채승병 Chae,Seungbyung (mailto:chess@kaist.ac.kr)
%% @date    2004. 11. 12.
%%
%% @requirement
%% teTeX, fpTeX, teTeX 등의 LaTeX2e 배포판
%% + 은광희 님의 HLaTeX 0.991 이상 버젼 또는 홍석호 님의 HPACK 1.0
%% : 설치에 대한 자세한 정보는 http://www.ktug.or.kr을 참조바랍니다.
%%
%% @note
%% 기존에 널리 쓰여오던 차재춘 님의 학위논문양식 클래스 파일의 형식을
%% 따르지 않고 전면적으로 다시 작성하였습니다. 논문 정보 입력부분에서
%% 과거 양식과 다른 부분이 많으니 아래 예시에 맞춰 바꿔주십시오.
%% 버그 리포트는 http://gsa.kaist.ac.kr/thesis-form으로 보내주십시오.
%%
%% @acknowledgement
%% 본 예시 논문은 물리학과 박사과정 김용현 님의 호의로 제공되었습니다.
%%
%% -------------------------------------------------------------------
%% @information
%% 이 예제 파일은 hangul-ucs를 사용합니다. UTF-8 입력 인코딩으로
%% 작성되었습니다. hlatex의 hfont는 이용하지 않습니다. --2006/02/11

% @class kaist.cls
% @options [default: doctor, korean, final]
% - doctor: 박사과정 | master : 석사과정
% - korean: 한글논문 | english: 영문논문
% - final : 최종판   | draft  : 시험판
% - pdfdoc : 선택하지 않으면 북마크와 colorlink를 만들지 않습니다.
\documentclass[master,english,final]{kaist-ucs}

% kaist.cls 에서는 기본으로 dhucs, ifpdf, graphicx 패키지가 로드됩니다.
% 추가로 필요한 패키지가 있다면 주석을 풀고 적어넣으십시오,
%\usepackage{...}
\usepackage{color}
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage{pdflscape}
\usepackage{hyperref}
\usepackage{multirow}

% @command title 논문 제목
% @options [default: (none)]
% - korean: 한글제목 | english: 영문제목
\title[korean] {이족 보행 동역학의\linebreak 생체 역학적인 접근방법}
%\title[english]{Spectral-based Shape Correspondence \linebreak with Diffusion Geometry}
\title[english]{A Biomechanical Approach to Biped Dynamics}

% @note 표지에 출력되는 제목을 강제로 줄바꿈하려면 \linebreak 을 삽입.
%       \\ 나 \newline 등을 사용하면 안됩니다. (아래는 예시)
%\title[korean]{탄소 나노튜브의 물리적 특성에 대한\linebreak 이론 연구}
%\title[english]{Theoretical study on physical properties of\linebreak
%                carbon nanotubes}

% @command author 저자 이름
% @param   family_name, given_name 성, 이름을 구분해서 입력
% @options [default: (none)]
% - korean: 한글이름 | chinese: 한문이름 | english: 영문이름
\author[korean] {김}{거 엽}
\author[chinese]{金}{거 엽}
\author[english]{Kim}{Geo Yeob}

% @command advisor 지도교수 이름 (복수가능)
% @usage   \advisor[options]{...한글이름...}{...영문이름...}{signed|nosign}
% @options [default: major]
% - major: 주 지도교수  | coopr: 공동 지도교수
\advisor[major]{신 성 용}{Shin, Sung Yong}{signed}
%\advisor[coopr]{홍 길 동}{Gil-Dong Hong}{nosign}

% @command department 학과이름 - 아래 표에 따라 코드를 입력
%
% 물리 PH
% 수리과학 MAS
% 화학 CH
% 생명과학 BS
% 바이오및뇌공학 BiS
% 의과학대학원 MSE
% 의과학학제 BM
% 기계공학 ME
% 항공우주공학 AE
% 건설 및 환경공학 CE
% 산업디자인 ID
% 생명화학공학 CBE
% 신소재공학 MS
% 원자력 및 양자 NQE
% 자동차기술대학원 AT
% 전기및전자공학 EE
% 전산학 CS
% 산업 및 시스템공학 IE
% 반도체학제 STE
% 소프트웨어 프로그램 SEP
% 정보통신학제 TE
% 고분자학학제 PSE
% 과학기술학학제 STS
% 나노과학기술학제 NT
% 로봇공학학제 RE
% 문화기술학제 CT
% 환경·에너지공학학제 ENV
% e-매뉴팩쳐링리더십학제 EML
% 문화기술대학원 GCT
% 경영공학 MT
% 테크노경영 TM
% 금융 FIN

\department{CS}

% @command studentid 학번
\studentid{20084004}

% @command referee 심사위원 (석사과정 3인, 박사과정 5인)
\referee[1]{신 성 용}
\referee[2]{조 성 호}
\referee[3]{        }

% @command approvaldate 지도교수논문승인일
% @param   year,month,day 연,월,일 순으로 입력
\approvaldate{2010}{12}{24}

% @command refereedate 심사위원논문심사일
% @param   year,month,day 연,월,일 순으로 입력
\refereedate{2010}{12}{24}

% @command gradyear 졸업년도
\gradyear{2011}

% 본문 시작
\begin{document}
%\begin{CJK*}[HL]{KS}{}

\begin{abstract}
Adopting physically-based dynamics model for synthesizing character animation is widely used.
Since most concepts of dynamics and physical simulation came from robotics and mechanical engineering,
biped models used in character animation also took a form of robots.
The robot-like biped models have actuated joint motors in their respective joints,
so that the motors are controlled to rotate bodies to make desired poses.

We present a new biped model based on the biomechanical idea that human movements are occurred
by controlling muscle fibers attached to skeletal structures instead of actuated motors on joints.
Also an optimization-based tracking control scheme for walking and balancing using our model is introduced.
By changing muscle fiber parameters and constraints, various human motions are synthesized.

%Relative joint angles between two bodies can be controlled using its motor attached to them,
%however, the global orientation and position of the biped cannot be controlled since
%they have no controllable elements exist.
\end{abstract}


% 목차 (Table of Contents) 생성
\tableofcontents

% 표목차 (List of Tables) 생성
\listoftables

% 그림목차 (List of Figures) 생성
\listoffigures

% 위의 세 종류의 목차는 한꺼번에 다음 명령으로 생성할 수도 있습니다.
%\makecontents

\chapter{Introduction}
Being an essential component for animations and video games,
bipedal character animation techniques have drawn much attention from
both academia and industry. Physically-simulated approaches have been
adopted to synthesize realistic and physically correct motions
automatically instead of relying on labor-intensitve key-frame animation
techqniues. In these approaches, a character is designed and controlled
as a consistent dynamic model, being represented as an articulated
figure. This model consists of a set of body segments, each being
considered as a rigid body, and joints connecting these segments.
This kind of models is used widely due to their adquacy to formulating
the Lagrangian equations of motion using the generalized coordinates
which simplifies motion description.
The joints used in the model are considered as ideal rigid joints,
that is, each of them connects the two rigid bodies with a certain DOFs.
Typically, translational DOFs are not treated in joints to disallow a dislocation of bones.
For example, hinge joints with one DOF are used at knees or elbows and
ball joints with three DOFs are used at hips. Actuation on the joints
changes their respective DOFs. Thus it is natural to call this kind of joints
\emph{actuated motor joints}. Motions can be created by
controlling these motor joints properly. In robotics this approach is
commonly adopted. The main interest of creating motions
with a dynamics model is focused on how to design the motor joint controllers.

The concept of actuated motor joints is unrealistic in the perspective of
biomechanics. No human being has that kind of motors in their joints.
Humans control their legs or arms by pulling bones using attached
muscles. Although the whole mechanism is quite complicated,
the structure of human muscle fibers is well-known, and biomechanical
results are availble concerning the most basic human actions
such as walking and jumping \cite{citeulike:2547705, citeulike:7093575}.

This thesis presents a biomechanical approach to biped dynamics. We
introduces muscle fibers as the only actuating elements
of the biped and get rid of all rigid motor joints in the previous biped
models. Consequently, joints are not rigid anymore in our approach.
We use ligaments in the place of joints
to hold the bodies firmly but not rigidly. This substitution
simulates human cartilages, which provide a shock absorption
system to sustain stability when external or internal disturbances exist \cite{shock}.
We control the rigid bodies with muscle fibers each of which are modeled as
a spring-damper system. Every muscle fiber has a linear actuator and
motions are created by controlling the actuator. Instead of controlling
the bodies with motor joints, it is highly effective in energy consumption
since torques are created more easily by pulling the bones with a muscle
fiber which lie at a distant place from an axis of rotation.

Besides the muscle-actuated character model we adapt the concept of
human gait phases to control biped locomotion. Human gait analysis is an extensively
studied area, and deals with the mechanism of human locomotion
by throughly experimenting and measuring subjects.
A human walking cycle consists of a sequence of phases, each of which has
its own objective and features.
In computer animation, such biomechanical research results have not fully exploited yet.
Previous approaches rely on optimization-based
techniques such as a motion tracker with a linear quadratic regulator (LQR)
or a quadratic programming optimizer and concentrate on the high level
objectives such as minimizing the actuation force or following the reference
trajectory without considering how human being tries
to achieve it biomechanically. For instance, in our model, a set of muscle fibers is
actuated according to a certain gait phase and the other fibers remain
unactuated to utilize its passive energy while prevalent approaches blindly seek
this kind of the natural human behavior with the macroscopic objectives.
Although seemingly having succeeded for generating nice-looking motion,
they can be enhanced by introducing biomechanical knowledge into both
a dynamics model and an optimization scheme.


\chapter{Related work}
Designing and controlling a physically simulated character is a long-standing
challenge in robotics and computer graphics. A physically
synthesized motion that actively responds to the environment is quite
promising because it is hard to keyframing a natural animation for every motion
manually. Although the combination of motion capture data and manual keyframing
shows a quality of motion, it is not straightforward to make a character
interacts with its environment if a pre-recorded motion clip is used.
By adapting physical simulation into a character animation we can overcome
this issue. The problem is that still there is no ultimate solution for controlling
a simulated character motion.

Some approaches proposed a controller which is based on the fact
that the ground reaction forces or contact forces affect the global
DOFs of the character significantly \cite{SCA07:249-258:2007, journals/tog/MuicoLPP09}.
Muico and his colleagues
presented a contact-aware controller \cite{journals/tog/MuicoLPP09}.
The approach is
heavily based on the theory of optimal control \cite{lewis}.
They modified the LQR to consider the presence of the ground reaction forces.
We also take the contact forces into account but in a different way.
The estimated contact forces are calculated using a linear complementarity
problem (LCP) before any actuation applied. The actuation force is then
determined with the consideration of the estimated contact forces.

Using an optimization technique for biped control is relatively complicated method.
There exists a simpler way to control. KangKang Yin and her colleagues
presented a simple proportional-derivative (PD) control framework \cite{journals/tog/YinLP07}.
They used a finite state machine (FSM) in which target poses are defined
for each state. Compared to the complexity of dynamics model,
the structure of controller is simple and robust to external disturbances.
Since they do not consider energy efficiency or passive forces during
simulation, the animation shows some stiff behavior.
Even if we can get more elaborate animations by increasing
the number of states in the FSM, it is not practically possible since the
number of parameters is proportional to the number of states.

Optimization-based approaches shown to be a good way to address many challenges
in biped control such as high dimensionality, underactuated-ness and
nonlinearity. Most of work set up their goal to determine the joint
torques to make a desired pose or a sequence of desired poses.
Instead of finding joint torques, Jain and his colleagues formulated
an optimization problem which finds joint angles directly \cite{Jain:09:OIM}. The joint torques
are implicitly calculated during the optimization process. The advantage of
this approach is that it is easy to design various types of objectives such as
moving a hand to nearby wall or placing a swing foot to some place while it
is not intuitive to formulate with torque-based optimization techniques.

%------%

Our goal is not so different from these work. However these work mainly focused
on the controller design and not the character model itself. Our work is
partly relies on the idea stuided in the field of biomechanics.
Some researchers in biomechanical engineering focus on the movement
disorder and the biomedical applications such as artificial joints.
There are abundant work exist which use a model similar to
a real human body since it is important to study the mechanism of underlying
structure of human body in that area \cite{vr-305}. Thelen and his colleagues
illustrated
the algorithm to compute muscle excitation patterns that produce
coordinated movements of muscle-actuated dynamic models \cite{Thelen2003321}.
They simulated
a pedaling motion while fixing the upper body to investigate the excitation
pattern of 30 muscle fibers which significantly affecting leg movements.

Liu and her colleagues tried to exploit the passive characteristics of
muscle fiber by including a torsion spring in joints \cite{Liu:2005:LPB}.
However, the actuation
is still occurred by joint motors and the muscle fibers are not explicitly used.

The action for each muscle groups can be anticipated by adopting the
fact regarding to gait phases \cite{perry}. The gait phases are the essential component
when analyzing a person's walking pattern. It directly identifies the
functional significance of the different motions occurring at the
individual joints. While controlling the character we
can determine the current gait phase. For each gait phase,
a set of muscle fibers from the entire muscles is selected to be actuated
and the others will be unactuated. This approach will give us an explicit
way to make full use of passive energy.

%The muscle fiber model we use is composed of two springs and a damper.
%This simple muscle model is explained in detail in the supplementary
%documents [SHADMEHR]. In the document they assume that spring stiffness constants
%and viscosity of the damper are constants. Some studies suggest that animals
%vary stiffness according to the specific locomotion task.[FARLEY]
%Since the model consists of springs we definitely need rest lengths for that
%springs. However rest lengths are not simply defined on real muscles.
%[...]


\chapter{Problem definition}

We model a character which consists of rigid bodies and virtual muscle fibers.
With this biomechanical model we design a reference trajectory tracker.
Specifically we build the equations of motion which have the
form of
\begin{equation}\label{MoEq}
\mathbf{M}(\chi)\ddot\chi + C(\chi,\dot\chi ) = f_g(\chi) + f_c(\chi, \dot\chi, \tau ) + \tau (\chi, \dot\chi, u)
\end{equation}
where $\mathbf{M}$ is a generalized mass matrix and $\chi$ is a generalized
linear and angular position
state vector and $\dot\chi$, $\ddot\chi$ are its first and second time derivatives,
respectively. $C$ represents Coriolis and centrifugal forces.
$G$ and $f_c$ represents gravitational forces and contact forces.
$\tau$ and $u$ denotes muscle tension and actuation forces.
For the case of a freely moving single
rigid body with 6-DOF, $\mathbf{M}$ will be $6\times 6$ matrix and $\chi$,
$f_c$, $\tau$, $C$ and $G$ will be a 6-dimensional vector. The dimension of $u$ is
determined by the number of muscle fibers. We have control
over none of the variables such as $\chi$, $\dot\chi$, $\ddot\chi$ and $f_c$.
$f_c$ is uncontrollable because it is the ground reaction force. This means that
$f_c$ is a reaction force arises by pushing the ground with the character's feet.
The only way to change $\chi$ to a certain desired value is done by controlling $u$
properly. If we denote a reference position and velocity from motion capture data
as $\bar\chi$ and $\dot{\bar\chi}$, \eqref{MoEq} can be more elaborated
to reveal its structure as a tracker:

\begin{equation}\label{MoEq2}
\mathbf{M}(\chi)\ddot\chi + C(\chi,\dot\chi ) = f_g(\chi) + f_c(\chi, \dot\chi, \tau ) + \tau (\chi, \dot\chi, \bar\chi, \dot{\bar\chi}).
\end{equation}
Note that the muscle actuation force $u$ is calculated in $\tau$ internally.

Unfortunately, $C$, $f_c$ and $\tau$ are highly nonlinear functions of the current state and the
actuation forces, it is hard to figure out the actuation forces which attain
the desired acceleration of the system. To make matters worse, $f_c$ is the function
of muscle forces $\tau$, it is extremely difficult or even impossible
to solve \eqref{MoEq2} for the function of $\tau$ or $u$ in a closed-form
equation.
To make the problem tractable, we make a few assumption.

Because we represent times as discrete samples, all the functions of
time-varying variables need to be represented in a discrete domain.
We discretize the time into samples with small intervals $h$. We define
the velocity $\dot\chi^{(l)}$ and the acceleration $\ddot\chi^{(l)}$, at current
time sample $l$, by backward and central finite differences, respectively.

\begin{align}
\dot\chi^{(l)}  \equiv {} & \frac{\chi^{(l)}-\chi^{(l-1)}}{h}\label{vel-dis}\\
\ddot\chi^{(l)} \equiv {} & \frac{\chi^{(l+1)}-2\chi^{(l)}+\chi^{(l-1)}}{h^2}\label{acc-dis}
\end{align}


\chapter{Algorithm overview}

Given motion capture data for human locomotion, we classify the motion
sequence automatically into respective phases. For each phase,
an optimization formulation is built to calculate muscle actuation forces
of our biped model. The actuated and unactuated muscles are explicitly configured
with respect to a corresponding phase.

\begin{figure}[h!]
  \centering
  \includegraphics[width=0.75\textwidth]{overview}
  \caption{Algorithm overview diagram}
\end{figure}


\pagebreak

\section{Dynamics algorithm}

\section{Rigid body dynamics}

The concept of rigid body is commonly used in a physically-simulated
character model.
Our character model is a full four-limbed biped, which consists of 14 rigid bodies.
The forward dynamics algorithm gives the following equation:

\begin{equation}
\ddot\chi =\mathbf{M}^{-1}(\chi) ( \tau - C(\chi,\dot\chi) ).
\end{equation}

We define a discrete-time state vector $Y$. For brevity, we use $Y^{(l)}$
to indicate a discrete-time value of $Y$ at $l$-th time step $Y(t_l)$.
We use an explicit Euler integration
scheme using both $Y$ and the equations of motion to derive a complete
forward dynamics formulation.

\begin{equation}
Y^{(l)} =
\left[ {\begin{array}{cc}
 \chi^{(l)}   \\
 \dot\chi^{(l)}   \\
 \end{array} } \right]
\end{equation}

\begin{equation}
f(Y^{(l)})=\dot{Y}^{(l)}
=
\left[ {\begin{array}{cc}
 \dot\chi^{(l)}   \\
 \ddot\chi^{(l)}   \\
 \end{array} } \right]
 =
\left[ {\begin{array}{cc}
 \dot\chi^{(l)}   \\
 \mathbf{M}^{-1}(\chi^{(l)}) ( \tau^{(l)} - C(\chi^{(l)},\dot\chi^{(l)}) )   \\
 \end{array} } \right]
\end{equation}

\begin{equation}
Y^{(l+1)}=Y^{(l)}+hf(Y^{(l)})
\end{equation}
Note that we need the position and velocity values of a certain time step
to store the state because the equations of motion for rigid bodies
are the second order differential equations.
If we model a dynamics system
which can be expressed by the first order differential equations of motion
then we need only a position as the state vector.



As stated in the previous section most of the existing work on
character animation used an articulated body to represent a character.
In the articulated body each body is connected to another body with
various types of joints. Since we use no joint at all in the character
model the mathematics involved in the dynamics system becomes quite
simple. We do not need to impose implicit or explicit constraints for
maintaining each body connected by joints stick together.
We assume that rigid bodies are independent to each other and thus we just build the
equations of motion which have $n$ rigid bodies floating around the
space freely with 6-DOF.

The equations of motion for a single rigid body is as follows:

\begin{equation}
\left[ {\begin{array}{cc}
 \bar{m}\mathbf{I}  &  0 \\
 0            & \mathbf{H}  \\
 \end{array} } \right]
 \left[ {\begin{array}{c}
 a  \\
 \alpha              \\
 \end{array} } \right]
 +
 \left[ {\begin{array}{c}
 0  \\
 \omega\times(\mathbf{H}\omega)   \\
 \end{array} } \right]
 =
 \left[ {\begin{array}{c}
 f  \\
 \tau   \\
 \end{array} } \right].
\end{equation}

This formulation is very easy to understand the structure of
the physical system. It reveals the linear and angular quantities
directly as well as the external forces and torques.


\begin{table}[h!]
\centering
  \begin{tabular}{cllll}
                                                             & Name      & Mass  & Dimension                & Inertia tensor           \\
      \hline
      \multirow{8}{*}{\includegraphics[width=0.85in]{biped}} & head      & 1.0   & $10 \times 10 \times 10$ & $10 \times 20 \times 30$ \\
                                                             & trunk     & 1.0   & $10 \times 10 \times 10$ & $10 \times 20 \times 30$ \\
                                                             & calf      & 1.0   & $10 \times 10 \times 10$ & $10 \times 20 \times 30$ \\
                                                             & thigh     & 1.0   & $10 \times 10 \times 10$ & $10 \times 20 \times 30$ \\
                                                             & foot      & 1.0   & $10 \times 10 \times 10$ & $10 \times 20 \times 30$ \\
                                                             & toe       & 1.0   & $10 \times 10 \times 10$ & $10 \times 20 \times 30$ \\
                                                             & upper arm & 1.0   & $10 \times 10 \times 10$ & $10 \times 20 \times 30$ \\
                                                             & lower arm & 1.0   & $10 \times 10 \times 10$ & $10 \times 20 \times 30$ \\
  \hline
\end{tabular}
\caption{Biped configuration}
\end{table}


\section{Muscle fiber dynamics}

There are many variants of muscle fiber model used in biomechanical field range
from a simple time-invariant spring model to a complicated time-varying model. \cite{25733}
Although a more sophisticated model gives us a more realistic behavior, unnecessarily
complicated models will make the biped hard to simulate and control.
For a compromise, we use one of the simplest time-invariant spring-damper model commonly called
a Hill type muscle model. \cite{hill}.

\begin{figure}[h!]
  \centering
  \includegraphics[width=2.75in]{musclemodel}
  \caption{Hill type muscle model}
\end{figure}

\noindent Basically, the model consists of two springs, a viscous damper and a actuation component.
The damper and one of the springs are connected in parallel and the other spring is
connected in serial. The active component in which our controller
can actuate resides in parallel side.
In real human body, many muscle fibers form bundles called \emph{fascicles}.
And multiple fascicles form a body of muscle.
To simplify our biped model, we use less than 10 muscle fibers to represent a certain kind of muscle body.
In the Hill type muscle model, we need four parameters for each:
a serial spring constant $k_{se}$, a parallel spring constant $k_{pe}$, a viscosity $b$ and a rest length $x_{r}$.
These parameters can be constants or variables depending on how muscle fibers modeled.
A mathematical expression defining dynamics of the muscle fiber is a first-order ordinary differential equation:

\begin{equation}\label{Tension}
\dot{T} = \frac{k_{se}}{b} \left( k_{pe}(x-x_{r})+b\dot{x}-\left(1+\frac{k_{pe}}{k_{se}}\right)T+u   \right)
\end{equation}
where $T$ is a tension exerted at both ends (positive means pulling), $x$ is the length of the fiber and $u$ is actuation force in the active component.
Note that all quantities shown in the equation are scalar values.
A muscle fiber always connects two rigid bodies and the same amount of
tension is applied to both of them with opposite directions.


There are muscle terminology to clearly define the configuration of muscles.
A muscle fiber has an $origin$ and an $insertion$ which indicate the attached position
of various muscle fibers at certain bones.
In other words, an origin and an insertion refer where a muscle fiber is originated from and inserted to, respectively.
If we denote the origin and insertion position of the fiber as $p_{org}$ and $p_{ins}$ in Cartesian coordinates,
the normalized direction of the fiber can be defined as $\hat{d}=(p_{ins}-p_{org})/||p_{ins}-p_{org}||$.
Thus, we can calculate tension $T\hat{d}$ and $-T\hat{d}$ which are applied to the origin and insertion body of the fiber, respectively.

We use two types of muscle fibers: actuated and unactuated muscle fibers.
Actuated muscle fibers represent the muscles we can actuate. Typically
they are attached to a middle of bones. Unactuated muscle fibers represent
ligaments around joints. We cannot deliberately actuate ligaments. Their
purpose is to maintain its rest length to prevent rigid bodies from
dislocations. For this reason, spring constants for ligaments are
comparatively larger than the actuated muscle fibers'.
In our system, the rest length of ligaments are configured to a small value.
This implies that the fiber length $||p_{ins}-p_{org}||$ happen to be zero
or near zero sometimes during simulation. In that case, we simply set
$x$ and $\dot{x}$ to zero.

An \emph{agonist}, or \emph{prime mover}, is a muscle whose contraction is chiefly responsible for producing a particular movement.
A muscle fibers has its \emph{antagonist}. The antagonist is a muscle whose action opposes that of a particular agonist.
We can choose specific muscle fibers to be used in the biped model based on agonists related to legs.
Also we can inform the optimizer to reduce actuation force on a muscle fiber when its antagonist is actively actuated.
\pagebreak


\section{Soft joints}

Conventional biped models use reduced coordinates to represent a state.
They use a 6-DOF value on the root of the biped for position and orientation.
States for other bodies composing the biped have three or less DOFs with respect to joint types.
Since the other bodies have its own parent body, states are defined in the parent body local coordinates.
For instance, a calf has 1-DOF since its parent is a thigh and they are connected with a knee joint.
On the contrary, every body in the biped model we propose has a full 6-DOF to allow a slight joint dislocation.
In dynamics point of view, multiple rigid bodies are simulated individually without any joint constraints involved.
Without joint constraints, the pose of biped is not maintained occasionally due to a serious joint dislocation occurred during optimization process.
For instance, all bodies tend to collapse to the ground rather than preserving its normal pose when a high cost is given to the muscle fiber actuation.
By all means a certain human pose should be maintained and that is critically related to degrees of the joint dislocation.
We introduced a biomechanically-inspired ball joint to our biped model.
There are certain points defined in body coordinates on the bodies.
Two points came from two different bodies may form a soft joint.
The distance between two points should be constrained to $\epsilon$ or smaller where $\epsilon$ is a joint dislocation threshold.
To satisfy the constraints, we connect these two points with a stiff ligament fiber.
We assume that ligament fibers have no cost for actuation.
With these kind of joints, the biped can take advantages of shock absorption mechanism as well as prevention of joint dislocation.

\begin{figure}[h!]
  \centering
  \includegraphics[width=1.5in]{softjoint}
  \caption{Structure of a soft joint}
\end{figure}


\section{Contact model}

There are various kind of techniques to deal with the calculation of contact forces between rigid bodies.
The existing algorithms can be divided into three categories: constraint-based, penalty-based and impulse-based approaches.
In constraint-based methods, the contact forces are computed by solving an optimization problem such as linear complementarity problems (LCP).
The contact forces are calculated most precisely using LCP.
However, it is tricky to implement correctly and the solutions may not be found although they are exist or it is unsolvable in some cases \cite{StewartT00}.
These shortcomings are improved in \cite{Anitescu}.
They introduced a LCP formulation which guarantees that the contact problem always has a solution which will be found by Lemke's algorithm.
Penalty-based methods compute the contact forces by considering a contact as a spring-damper.
It is scalable and easy to implement. However it requires very short integration step especially at collisions and in most cases non-penetration conditions are violated.
Impulse-based methods model contacts as successive collisions instead of persisting contacts.

As long as the biped's poses are properly managed, our simulation configuration contains a relatively small number of contact points.
Contact forces are crucial because the root position and orientation of the biped can be controlled only by that forces.
Therefore physically conforming contact forces are important in the point of believable character animation.

We use a penalty method which can be easily integrated in our optimization framework.
The time-stepping method based on LCP is hard to combine with our quadratic programming (QP) formulation
because there is a case that LCP is not transformed into QP, \emph{i.e.},
a matrix involved in constraints is not a symmetric positive matrix.

A penalty method is a way to calculate contact normal forces with allowing a certain amount of penetration.
A temporary spring-damper element is created and attached where a contact is established.
The spring-damper exerts a strong force to separate two penetrated bodies.
After non-penetration constraints recovered the spring-damper is removed immediately.
Typically, a critically-damped spring is used to make the separation time minimal without oscillation.

\begin{figure}[h!]
  \centering
  \includegraphics[width=2.5in]{penalty}
  \caption{Normal force calculated from the penalty method}
\end{figure}

Normal force exerted at the penetrated corner point of the box is calculated as follows:

\begin{equation}\label{penalty-normal}
f_n = -k x_{pendep} - c \dot{x}_{pendep}
\end{equation}
where $f_n$ is the normal force, $k$ is a spring constant, $c$ is a damping coefficient and $x_{pendep}$ is
a penetration depth. $k$ and $c$ is positive numbers and $x_{pendep}$ is a negative in case of penetration.
If a single rigid body of body mass $\bar{m}$ has $n_p$ contact points with the ground,
$n_p$ springs of the damping coefficient $c=2\sqrt{\bar{m}k/n_p}$ makes a critically damped system.

Since any normal force should be applied in unilateral manner, \emph{i.e.},
only pushing a penetrated body not pulling, we need an additional constraint $f_n \geq 0$.
$x_{pendep}$ will be always a negative scalar, so the term $-kx_{pendep}$ is always become a positive.
A problem arises when a penetrated corner point is in a separation phase,
especially when $kx_{pendep} < c\dot{x}_{pendep}$ which leads $f_n$ to a negative value.
To circumvent this issue, we add a nonnegative positive scalar term $\lambda$ to the right-hand side
of \eqref{penalty-normal} to obey the constraint $f_n \geq 0$. During optimization,
a minimal $\lambda$ to keep the constraint will be calculated
when we set a very high cost on that variable. We can denote \eqref{penalty-normal} with
discrete-time substitution that can be used as an equality constraint for the optimizer.

\begin{equation}\label{penalty-normal-discretized}
f_n = -k x_{pendep}^{(l+1)} - c \frac{x_{pendep}^{(l+1)} - x_{pendep}^{(l)}}{h} + \lambda
\end{equation}

Besides normal force, tangential contact force are needed to model friction.
Coulomb friction model is widely used.
There are two kinds of friction in this model: static friction and dynamic friction.
If contact points are sliding along the surface without breaking contacts,
dynamic friction force will act upon them. In this case, the friction force is depends
on the magnitude of normal force and velocity of sliding contact point along the surface.
Dynamic friction force $f_{tk}$ is
\begin{equation}\label{dynamic-friction}
f_{tk} = -\mu_k v |f_n|
\end{equation}
where $\mu_k$ is a coefficient of dynamic friction
and $v$ is velocity of sliding contact point along the surface.
On the other hand, static friction force occurs on a stationary contact point.
Contact force, that is sum of static friction and normal force, should lies on a cone
which is called Coulomb's friction cone.
It is allowed to choose any static friction force if the resulting contact force is
inside on the cone. We have two equations to express conditions of the static friction force:

\begin{equation}\label{static-friction}
\mu_s |f_n| \geq |f_{ts}|, \quad f_{ts} \cdot \hat{f}_n = 0
\end{equation}
where $f_{ts}$ is static friction force and $\mu_s$ is a coefficient of static friction.
Inner product equality implies that $f_{ts}$ should lies on the tangential space of contact point.


\chapter{Integration}

In general, controlled physical simulations are done in two steps.
First is to compute necessary forces or torques for control and
second is to integrate them to get a next state.
There are several integration techniques.
The most easy and intuitive one is an explicit Euler integration.
Most of rigid body systems can be simulated using an explicit Euler method
as far as there is no stiff component exists. The explicit integration
allows us a simple implementation and fast computation of a next state,
however, it has the potential of instability when the time step is larger
then a certain threshold. The threshold is mainly determined by a time
constant of a given differential equation we need to integrate.
In Euler method, next state is computed by the following equation:
\begin{equation}
Y^{(l+1)}=Y^{(l)} + hf(Y^{(l)}).
\end{equation}
where $h$ is an integration time step.
It is obvious that larger $h$ value will cause instability to the system.

On the contrary, an implicit integration does not suffer from this kind of
instability issue. The formula is like the following:
\begin{equation}
Y^{(l+1)}=Y^{(l)} + hf(Y^{(l+1)}).
\end{equation}
That is, we want to find the next state $Y^{(l+1)}$ where we
reverse the time step by $-h$ from $Y^{(l+1)}$, we get to the current state
$Y^{(l)}$. In most cases, $f$ is a nonlinear function of $Y$, so we need to
linearize it to find closed form solution of $Y^{(l+1)}$. If we define a
variable $\Delta Y = Y^{(l+1)}-Y^{(l)}$, it can be calculated using the
following equation:

\begin{equation}\label{DeltaY}
\Delta Y = \left(  \frac{1}{h}\mathbf{1} - {\frac{\partial f}{\partial Y} \bigg|_{Y=Y^{(l)}}}\right)^{-1} f(Y^{(l)})
\end{equation}
where $\mathbf{1}$ is an identity matrix. We need an analytic form of
Jacobian $\partial f / \partial Y$ to calculate $\Delta Y$.

In our case, the time constant is dominated by muscle fibers because they consists
of highly stiff springs \eqref{Tension}. Even if we use a small time step
such as $h=0.01$, our system occasionally diverges slowly with the explicit Euler
integration. Therefore, it is obvious that the implicit integration scheme is right one to choose.
Unfortunately, it is not suitable for our simulation framework because
the control part and the integration part is combined into a single linear equation in our case.
Since $\Delta Y$ is not a linear function of $Y^{(l)}$, the implicit integration approach
is hard to be combined into our framework. For a compromise, we employed the explicit Euler
with very small time step.

\chapter{Optimization}
By gathering all constraints introduced so far, we get the following optimization formula.
\begin{equation}
\text{minimize} \quad w_{ref} || \chi^{(l+1)} - \chi^{(l+1)}_{ref} || + w_{com} || p^{(l+1)}_{com} - p^{(l+1)}_{com,ref} || + w_u || u ||
\end{equation}
\begin{align}
\text{subject to} & \quad \chi^{(l+1)} = \tilde{M}^{-1} (f_f + f_c + f_g + f_{ext} - \tilde{C})     &                      \\
                  & \quad f_{f_i} = (A_i u_i + B_i x_i^* + C_i) \frac{b_i - a_i}{ || b_i - a_i || } & i \in \mathcal{M}    \\
                  & \quad f_{c,i} = f_{n,i} + f_{tk, i}                                             & i \in \mathcal{P}_k  \\
                  & \quad f_{c,i} = f_{n,i} + f_{ts, i}                                             & i \in \mathcal{P}_s  \\
                  & \quad r_i \geq || Z_i \chi^{(l+1)} + V_i ||                                     & i \in \mathcal{J}
\end{align}
The optimizer tries to find the solution, next state $\chi^{(l+1)}$, which is
close to $\chi^{(l+1)}_{ref}$ provided from motion clip with minimal effort.
Deviation cost for COM is added as a cost term to give more importance on COM tracking.
The solution should satisfy four types of constraints:
equations of motion, muscle forces, contact forces, soft joints.
Optimization variables excluding dependent variables are $u$, $x^*$ and $f_{ts}$.
Solving the optimization problem is done for frame by frame.
After next state $\chi^{(l+1)}$ is calculated, current state is updated to
next state and the frame counter $l$ is increased by 1.

\chapter{Results}

\chapter{Conclusion}


%%
%% 한글요약문 시작
%%
%% Note. 영문논문일 경우에만 필요하니 한글논문의 경우에는 작성하지 마십시오.
%%
\begin{summary}

Korean summary

\end{summary}

%%
%% 참고문헌 시작
%%
\bibliographystyle{IEEETrans}
\bibliography{muscle.bib}

%%
%% 감사의 글 시작
%%

\acknowledgement

Acknowledgement


%%
%% 이력서 시작
%%
% @command curriculumvitae 이력서
% @options [default: 클래스 옵션 korean|english ]
% - korean : 한글이력서 | english : 영문이력서
\curriculumvitae[korean]

    % @environment personaldata 개인정보
    % @command     name         이름
    %              dateofbirth  생년월일
    %              birthplace   출생지
    %              domicile     본적지
    %              address      주소지
    %              email        E-mail 주소
    % - 위 6개의 기본 필드 중에 이력서에 적고 싶은 정보를 입력
    \begin{personaldata}
        \name       {김 거 엽}
        \dateofbirth{1985}{5}{6}
        %\birthplace {서울 영등포구 영등포동 ...}
        %\domicile   {대전 유성구 신성동 ...}
        \address    {서울특별시 영등포구 여의도동 대교아파트 5동 1213호}
        \email      {gasbank@naver.com}
    \end{personaldata}

    % @environment education 학력
    % @options [default: (none)] - 수학기간을 입력
    \begin{education}
        \item[2001. 3.\ --\ 2004. 2.] 여의도고등학교
        \item[2004. 3.\ --\ 2008. 8.] 연세대학교 전기전자공학부 (B.S.)
        \item[2008. 9.\ --\ 2011. 2.] KAIST 전산학과 (M.S.)
    \end{education}

    % @environment career 경력
    % @options [default: (none)] - 해당기간을 입력
    %\begin{career}
        %\item[1997. 3.\ --\ 1999. 2.] 한국과학기술원 전산학과 일반조교
    %\end{career}

    % @environment activity 학회활동
    % @options [default: (none)] - 활동내용을 입력
    %\begin{activity}
        %\item J. Choi, \textbf{Yong-Hyun Kim}, K.J. Chang, and D. Tomanek,
        %     \textit{Occurrence of itinerant ferromagnetism in C/BN superlattice
        %     nanotubes}, 5th Asian Workshop on First-Principles Electronic
        %     Structure Calculations, Seoul (Korea), October., 2002.
    %\end{activity}

    % @environment publication 연구업적
    % @options [default: (none)] - 출판내용을 입력
    %\begin{publication}
        %\item \textbf{Yong-Hyun Kim}, J. Choi, K.J. Chang, and D. Tomanek,
        %     \textit{Magnetic instability in partly opened C$_{60}$ isomers},
        %     in preparation.
    %\end{publication}



%% 본문 끝

%\end{CJK*}
\end{document}
